# Project Documentation

## Assumptions & Standards
- The back-end assumes and uses UTC as the standard time format.

## Project Overview
### database_scripts
- `create_database.sql`: SQL script for creating a non-existent database.
- `delete_database.sql`: SQL script for deleting a database.
 - Be warned that it will delete the database and all of its content.
- `insert_new_admin.sh`: bash script for inserting a new admin into the database.
 - Used to avoid making modifications to a production database directly (and accidentally messing something up).

### API Definition & Docs
- `index.yaml` defines the UniBar API.
- `server/openapi_server/openapi/openapi.yaml` defines the UniBar API to be used in the context of the back-end server.

## Code Overview
### `server/openapi_server/controllers`
- `default_controller.py` defines all endpoints.
- `security_controller.py` provides methods for authenticating users for endpoints which are to be authenticated (as defined in `/server/openapi_server/openapi`).

### `server/openapi_server/database`
- Contains files related to the database.
- At the moment, it only contains `db_rds.py` for defining an object to connect to an AWS RDS database.

### `server/openapi_server/models`
- Contains the objects for parsing the endpoint request with a JSON body.
- The models are auto-generated by openapi-generator, but were modified for better readability and to comply with the requirements.
- Models have a 1:1 mapping to an endpoint. Their name describes which endpoint they are mapped to.
- The `Order` model cannot compute it's status when being. So use the function `order_with_status` to compute the status after the object has been created.

### `server/openapi_server/test`
- Contains the files to test the REST API endpoints.
- Note that this directory is not used and the code is mostly from the auto-generated code from the openapi-generator program.

## Technical Debt
### High Priority
- Add uwaterloo email validation logic
- Make the logout endpoint a POST function instead of a GET
- (QOL) Remove deleting auth key from database when user logs out (so that user logging out from one device).

### Low Priority
- (security) Prevent password timing attacks
- (security) Improve password formatting (currently just min 8-chars)
- (security) Assign seperate tokens to different login-sessions.
- Add server shutdown command
- Add auth token timeout
- Combine models that use the exact same format.

## Review Checklist
1. All INSERT/UPDATE statements are followed by cursor.commit()
2. Make sure all API times are “datetime”
3. All authentication logic is correct
4. Make sure each “cursor.fetchone()” is followed by an assert that the entry has been fetched.
